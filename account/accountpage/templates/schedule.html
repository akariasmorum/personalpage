{% extends "base.html" %}
{% block context %}
	<style type="text/css">
		.event{
			position: relative;
		}
		.event:after{
			position: absolute;
			top: 20px;
			left:39%;
			content: '';
			
			content: '';

		   
		   width: 10px;
		   height: 10px;
		   -moz-border-radius: 7.5px;
		   -webkit-border-radius: 7.5px;
		   border-radius: 7.5px;
		   background-color: #FB2368;

		}
	</style>
	<div class='data row'>
            <div class="data cal" id="task">
              <ul class="list-unstyled">
                <li>12.10.2018 <br> Запись к терапевту</li>
                <li>12.10.2018 <br> Запись к терапевту</li>
                <li>12.10.2018 <br> Запись к терапевту</li>
                <li>12.10.2018 <br> Запись к терапевту</li>
                <li>12.10.2018 <br> Запись к терапевту</li>
                <li>12.10.2018 <br> Запись к терапевту</li>
                <li>12.10.2018 <br> Запись к терапевту</li>
                <li>12.10.2018 <br> Запись к терапевту</li>
                <li>12.10.2018 <br> Запись к терапевту</li>
                <li>12.10.2018 <br> Запись к терапевту</li>
              </ul>
            </div>
            <div class="data cal">
              <div id='calendar'>
                <div class = 'row month'>
                  <div class='month col prev-month'><h4><</h4></div>
	                  <div class ='month col' id='month-name'>
	                  Месяц
	                  </div>
                  <div class='month col next-month'><h4>></h4></div>

                </div>
                <div class="row week">
                  <div class="col">
                  Пн
                  </div>
                  <div class="col">
                  Вт
                  </div>
                  <div class="col">
                  Ср
                  </div>
                  <div class="col">
                  Чт
                  </div>
                  <div class="col">
                  Пт
                  </div>
                  <div class="col">
                  Сб
                  </div>
                  <div class="col">
                  Вс
                  </div>
                </div>
                <div id = 'dates-calendar' class = 'row'></div>
              </div>
            </div>
          </div>

          <script type="text/javascript">

class Calendar 
  {

    constructor(date, calendar, events){
      this.date = date
      this.calendar = calendar;
      this.months = ['Январь', 'Февраль','Март','Апрель','Май','Июнь','Июль','Август','Сентябрь','Октябрь','Ноябрь','Декабрь'];
      this.events = events;
    }

    daysInMonth(year, month){ //год соответствует и месяц соответствует с нашим
      var a = new Date(year, month, 0).getDate();      
      return a;
    }

    getDateDay(year, month, day){ //а вот тут месяцы с нуля почему то
      var thisDate = new Date(year, month, day);
      var a = [6,0,1,2,3,4,5]
      return a[thisDate.getDay()];
    }

    getMonthCalendarString(year, month){

      var firstDay = this.getDateDay(year, month,1);
      var start = [];
      for (var i=0;i<firstDay;i++){
        start.push('&nbsp');
      }
      var dim = this.daysInMonth(year, month+1);
      
      for(var i=1;i<=dim;i++){
        start.push(i);        
      }

      while (start.length % 7 !=0)
      {
        start.push('&nbsp');
      }

      return start;
    }

    ifEvent(date){
    	for(var i=0; i<this.events.length; i++)
    	{
    		
    		if (date.getTime() == this.events[i].getTime()){
    			return true;

    		}
    	}
    	return false;

    }

    drawCalendar(){   
      var dates = this.getMonthCalendarString(this.date.getFullYear(), this.date.getMonth()); 
      var currentRow = $('<div>', {'class': 'row dates'});
      
      var counter = 0;
      var currentPosition=$('<div>', {'class': 'col'});
      $("#month-name").text(this.months[this.date.getMonth()]);
      for(var i =0; i< dates.length; i++){
      	currentPosition=$('<div>', {'class': 'col'});
      	if(i%7==5 || i%7==6){
      		currentPosition.addClass('weekend');
      	}
      	if(Number.isInteger(dates[i]))
      	{
      		if (this.ifEvent(new Date(this.date.getFullYear(), this.date.getMonth(), dates[i])))
      		{
      			currentPosition.addClass('event');
      		}
      	}        
		
		currentPosition.html(dates[i])     ;   
        currentRow.append(currentPosition);
        if(i%7==6)
        {
          this.calendar.append(currentRow);
          currentRow = $('<div>', {'class': 'row dates'});
        }       

      }
    }

    getNextMonth(){
    	var a = this.date.getMonth();
      if(a==11){
        this.date = new Date(this.date.getFullYear()+1, 0, 1);
        
      }
      else{
      	var m = this.date.getMonth()+1;
        this.date = new Date(this.date.getFullYear(), m, 1);
        var d = this.date;
      }
      $('.dates').remove();
      var a = this.getMonthCalendarString(this.date.getFullYear(), this.date.getMonth());
      this.drawCalendar(a);
    }

    getPreviousMonth(){
      if(this.date.getMonth()==0){
        this.date = new Date(this.date.getFullYear()-1, 11, 1);
      }
      else{
       	this.date = new Date(this.date.getFullYear(), this.date.getMonth()-1, 1);
      }
      $('.dates').remove();
      var a = this.getMonthCalendarString(this.date.getFullYear(), this.date.getMonth());
      this.drawCalendar(a);
    }
    

  }
    
    
    
    

     
    window.onload = function(){
	      $("#sidebar").mCustomScrollbar({
	               theme: "dark"
	          });

	      $('#task').mCustomScrollbar({theme: "dark"});

	      $('#sidebarCollapse').on('click', function () {
	        // open or close navbar
	        $('#sidebar').toggleClass('active');
	        $('#content').toggleClass('active');
	        // close dropdowns
	        $('.collapse.in').toggleClass('in');
	        // and also adjust aria-expanded attributes we use for the open/closed arrows
	        // in our CSS
	        $('a[aria-expanded=true]').attr('aria-expanded', 'false');
	      });


	      var events = [
	      new Date(2018, 9, 15),
	      new Date(2018, 9, 18),
	      new Date(2018, 9, 20),
	      new Date(2018, 9, 21),
	    ] 

	    var current = new Date();
	    current.setHours(0,0,0,0)   
	    var weekday = ['Пн', 'Вт','Ср','Чт','Пт','Сб','Вс'];


	    console.log('curYear'+current.getYear());
	    console.log('curMonth'+current.getMonth());
	    console.log('curDate'+current.getDate());
	        
	    cal = new Calendar(current, $('#calendar'), events);
	    
	    
	    cal.drawCalendar();
	    $('.prev-month').click(function(){cal.getPreviousMonth()});
	    $('.next-month').click(function(){cal.getNextMonth()});
  
    }
    

      
    </script>

{% endblock %}        